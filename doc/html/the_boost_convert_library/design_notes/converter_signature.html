<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>Converter Signature</title>
<link rel="stylesheet" href="../../boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.78.1">
<link rel="home" href="../../index.html" title="Chapter&#160;1.&#160;The Boost Convert Library 2.0">
<link rel="up" href="../design_notes.html" title="Design Notes">
<link rel="prev" href="public_user_interface/todo_converter_parameter_related_considerations__explicit__default__globally_set__others_.html" title="TODO Converter-parameter-related considerations (explicit, default, globally-set, others)">
<link rel="next" href="../acknowledgements.html" title="Acknowledgements">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="spirit-nav">
<a accesskey="p" href="public_user_interface/todo_converter_parameter_related_considerations__explicit__default__globally_set__others_.html"><img src="../../images/prev.png" alt="Prev"></a><a accesskey="u" href="../design_notes.html"><img src="../../images/up.png" alt="Up"></a><a accesskey="h" href="../../index.html"><img src="../../images/home.png" alt="Home"></a><a accesskey="n" href="../acknowledgements.html"><img src="../../images/next.png" alt="Next"></a>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="the_boost_convert_library.design_notes.converter_signature"></a><a class="link" href="converter_signature.html" title="Converter Signature">Converter
      Signature</a>
</h3></div></div></div>
<p>
        The following converter signatures have been considered:
      </p>
<pre class="programlisting"><span class="keyword">bool</span> <span class="keyword">operator</span><span class="special">()(</span><span class="identifier">TypeIn</span> <span class="keyword">const</span><span class="special">&amp;,</span> <span class="identifier">TypeOut</span><span class="special">&amp;);</span> <span class="comment">//#1</span>
<span class="keyword">void</span> <span class="keyword">operator</span><span class="special">()(</span><span class="identifier">TypeIn</span> <span class="keyword">const</span><span class="special">&amp;,</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">optional</span><span class="special">&lt;</span><span class="identifier">TypeOut</span><span class="special">&gt;&amp;);</span> <span class="comment">//#2</span>
<span class="identifier">boost</span><span class="special">::</span><span class="identifier">optional</span><span class="special">&lt;</span><span class="identifier">TypeOut</span><span class="special">&gt;</span> <span class="keyword">operator</span><span class="special">()(</span><span class="identifier">TypeIn</span> <span class="keyword">const</span><span class="special">&amp;);</span> <span class="comment">//#3</span>
</pre>
<p>
        On the design level the signature #1 has the advantage of providing the best
        <span class="emphasis"><em>separation of concerns</em></span>. It leaves the respective converter
        only with one task -- the actual task of conversion. In practice though that
        can lead to inefficiencies. Namely, given an instance of <code class="computeroutput"><span class="identifier">TypeOut</span></code>
        type is supplied from outside, a storage for that instance needs to be allocated
        and, most importantly, that instance needs to be initialized. That initialization
        phase (which can be expensive) is an unnecessary overhead as, if the conversion
        operation succeeds, the initial value is overridden with the actual result,
        if it fails, then the <code class="computeroutput"><span class="identifier">TypeOut</span></code>
        instance of no use anyway.
      </p>
<p>
        The signature #2 avoids the initialization overhead. The storage for <code class="computeroutput"><span class="identifier">TypeOut</span></code> is still allocated outside but
        it is not initialized. It is now converter's responsibility to know <span class="emphasis"><em>how</em></span>
        to initialize the <code class="computeroutput"><span class="identifier">TypeOut</span></code>
        instance and to actually initialize it <span class="emphasis"><em>when</em></span> needed.
        In practice it usually easier than it sounds. For example,
      </p>
<pre class="programlisting"><span class="keyword">void</span> <span class="keyword">operator</span><span class="special">()(</span><span class="keyword">char</span> <span class="keyword">const</span><span class="special">*</span> <span class="identifier">value_in</span><span class="special">,</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">optional</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">&gt;&amp;</span> <span class="identifier">result_out</span><span class="special">)</span> <span class="keyword">const</span>
<span class="special">{</span>
   <span class="keyword">char</span> <span class="keyword">const</span><span class="special">*</span> <span class="identifier">str_end</span> <span class="special">=</span> <span class="identifier">value_in</span> <span class="special">+</span> <span class="identifier">strlen</span><span class="special">(</span><span class="identifier">value_in</span><span class="special">);</span>
   <span class="keyword">char</span><span class="special">*</span>       <span class="identifier">cnv_end</span> <span class="special">=</span> <span class="number">0</span><span class="special">;</span>
   <span class="keyword">long</span> <span class="keyword">int</span>     <span class="identifier">result</span> <span class="special">=</span> <span class="special">::</span><span class="identifier">strtol</span><span class="special">(</span><span class="identifier">value_in</span><span class="special">,</span> <span class="special">&amp;</span><span class="identifier">cnv_end</span><span class="special">,</span> <span class="identifier">base_</span><span class="special">);</span>

   <span class="keyword">if</span> <span class="special">(</span><span class="identifier">INT_MIN</span> <span class="special">&lt;=</span> <span class="identifier">result</span> <span class="special">&amp;&amp;</span> <span class="identifier">result</span> <span class="special">&lt;=</span> <span class="identifier">INT_MAX</span> <span class="special">&amp;&amp;</span> <span class="identifier">cnv_end</span> <span class="special">==</span> <span class="identifier">str_end</span><span class="special">)</span>
       <span class="identifier">result_out</span> <span class="special">=</span> <span class="keyword">int</span><span class="special">(</span><span class="identifier">result</span><span class="special">);</span>
<span class="special">}</span>
</pre>
<p>
        The signature #3 has been briefly considered as aesthetically advantageous
        and more idiomatic. Unfortunately, it lacked automatic deduction of the
        <code class="computeroutput"><span class="identifier">TypeOut</span></code> which, consequently,
        had to be specified explicitly. For different types of supported converters
        (class-based, plain old functions, lambdas) that complicated considerably
        the implementation of the <span class="emphasis"><em>Boost.Convert</em></span> infrastructure
        and restricted implementation of the respective converters.
      </p>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright &#169; 2009-2014 Vladimir Batov<p>
        Distributed under the Boost Software License, Version 1.0. See copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>.
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="public_user_interface/todo_converter_parameter_related_considerations__explicit__default__globally_set__others_.html"><img src="../../images/prev.png" alt="Prev"></a><a accesskey="u" href="../design_notes.html"><img src="../../images/up.png" alt="Up"></a><a accesskey="h" href="../../index.html"><img src="../../images/home.png" alt="Home"></a><a accesskey="n" href="../acknowledgements.html"><img src="../../images/next.png" alt="Next"></a>
</div>
</body>
</html>
