<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>The Default Constructible Type Requirement</title>
<link rel="stylesheet" href="../boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.75.2">
<link rel="home" href="../index.html" title="Chapter&#160;1.&#160;The Boost Convert Library 2.0">
<link rel="up" href="../index.html" title="Chapter&#160;1.&#160;The Boost Convert Library 2.0">
<link rel="prev" href="type_requirements.html" title="Type Requirements">
<link rel="next" href="performance.html" title="Performance">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="spirit-nav">
<a accesskey="p" href="type_requirements.html"><img src="../images/prev.png" alt="Prev"></a><a accesskey="u" href="../index.html"><img src="../images/up.png" alt="Up"></a><a accesskey="h" href="../index.html"><img src="../images/home.png" alt="Home"></a><a accesskey="n" href="performance.html"><img src="../images/next.png" alt="Next"></a>
</div>
<div class="section">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="the_boost_convert_library.the___default_constructible__type_requirement"></a><a class="link" href="the___default_constructible__type_requirement.html" title="The Default Constructible Type Requirement">The
    <span class="emphasis"><em>Default Constructible</em></span> Type Requirement</a>
</h2></div></div></div>
<p>
      (Not too) deeply in the bowels of the implementation a temporary-storage instance
      of the <span class="emphasis"><em>TypeOut</em></span> type is created and then populated with
      the conversion result. The <code class="computeroutput"><span class="identifier">boost</span><span class="special">::</span><span class="identifier">lexical_cast</span></code>
      implementation chooses the default constructor to create such an instance.
      Consequently, the <span class="emphasis"><em>TypeOut</em></span> type needs to be <span class="emphasis"><em>Default
      Constructible</em></span>. For more details see <a href="http://www.boost.org/doc/libs/1_55_0/doc/html/boost_lexical_cast.html" target="_top"><code class="computeroutput"><span class="identifier">boost</span><span class="special">::</span><span class="identifier">lexical_cast</span></code>
      documentation</a>.
    </p>
<p>
      <span class="emphasis"><em>Boost.Convert</em></span> also creates a temporary-storage instance
      of the <span class="emphasis"><em>TypeOut</em></span> type that the respective converter then
      populates with the conversion result. By default that temporary-storage is
      created with
    </p>
<pre class="programlisting"><span class="keyword">namespace</span> <span class="identifier">boost</span>
<span class="special">{</span>
   <span class="keyword">template</span><span class="special">&lt;</span><span class="keyword">typename</span> <span class="identifier">T</span><span class="special">&gt;</span> <span class="identifier">T</span> <span class="identifier">allocate_storage</span><span class="special">()</span> <span class="special">{</span> <span class="keyword">return</span> <span class="identifier">T</span><span class="special">();</span> <span class="special">}</span>
<span class="special">}</span>
</pre>
<p>
      and, therefore, the <span class="emphasis"><em>Default Constructible</em></span> requirement
      is also the <span class="emphasis"><em>default</em></span> requirement of the <span class="emphasis"><em>Boost.Convert</em></span>
      framework.
    </p>
<p>
      A well-designed type (in my opinion, anyway) should only have meaningful and
      unambiguous constructors... and the default constructor is not always and necessarily
      one of them. Consider the following as one such example:
    </p>
<pre class="programlisting"><span class="keyword">struct</span> <span class="identifier">direction</span>
<span class="special">{</span>
    <span class="keyword">enum</span> <span class="identifier">value_type</span> <span class="special">{</span> <span class="identifier">up</span><span class="special">,</span> <span class="identifier">dn</span> <span class="special">};</span>
    <span class="identifier">direction</span><span class="special">(</span><span class="identifier">value_type</span> <span class="identifier">value</span><span class="special">)</span> <span class="special">:</span> <span class="identifier">value_</span><span class="special">(</span><span class="identifier">value</span><span class="special">)</span> <span class="special">{}</span>
    <span class="keyword">private</span><span class="special">:</span> <span class="identifier">value_type</span> <span class="identifier">value_</span><span class="special">;</span>
<span class="special">};</span>
</pre>
<p>
      The <code class="computeroutput"><span class="identifier">direction</span></code> type has no default
      state. It is not <span class="emphasis"><em>Default Constructible</em></span> and, consequently,
      the following calls do not compile:
    </p>
<pre class="programlisting"><span class="identifier">direction</span> <span class="identifier">dir1</span> <span class="special">=</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">lexical_cast</span><span class="special">&lt;</span><span class="identifier">direction</span><span class="special">&gt;(</span><span class="identifier">str</span><span class="special">);</span> <span class="comment">// Does not compile</span>
<span class="identifier">direction</span> <span class="identifier">dir2</span> <span class="special">=</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">convert</span><span class="special">&lt;</span><span class="identifier">direction</span><span class="special">&gt;(</span><span class="identifier">str</span><span class="special">).</span><span class="identifier">value</span><span class="special">();</span> <span class="comment">// Does not compile</span>
</pre>
<p>
      However, <span class="emphasis"><em>Boost.Convert</em></span> is able to handle such a type with
      little help from the user -- the instructions <span class="emphasis"><em>how</em></span> to create
      that mentioned temporary-storage:
    </p>
<pre class="programlisting"><span class="keyword">namespace</span> <span class="identifier">boost</span>
<span class="special">{</span>
   <span class="keyword">template</span><span class="special">&lt;&gt;</span> <span class="keyword">inline</span> <span class="identifier">direction</span> <span class="identifier">allocate_storage</span><span class="special">&lt;</span><span class="identifier">direction</span><span class="special">&gt;()</span>
   <span class="special">{</span>
       <span class="keyword">return</span> <span class="identifier">direction</span><span class="special">(</span><span class="identifier">direction</span><span class="special">::</span><span class="identifier">up</span><span class="special">);</span>
   <span class="special">}</span>
<span class="special">}</span>

<span class="special">...</span>

<span class="identifier">direction</span> <span class="identifier">dir1</span> <span class="special">=</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">lexical_cast</span><span class="special">&lt;</span><span class="identifier">direction</span><span class="special">&gt;(</span><span class="identifier">str</span><span class="special">);</span> <span class="comment">// Does not compile</span>
<span class="identifier">direction</span> <span class="identifier">dir2</span> <span class="special">=</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">convert</span><span class="special">&lt;</span><span class="identifier">direction</span><span class="special">&gt;(</span><span class="identifier">str</span><span class="special">).</span><span class="identifier">value</span><span class="special">();</span> <span class="comment">// Compiles</span>
</pre>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright &#169; 2009-2014 Vladimir Batov<p>
        Distributed under the Boost Software License, Version 1.0. See copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>.
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="type_requirements.html"><img src="../images/prev.png" alt="Prev"></a><a accesskey="u" href="../index.html"><img src="../images/up.png" alt="Up"></a><a accesskey="h" href="../index.html"><img src="../images/home.png" alt="Home"></a><a accesskey="n" href="performance.html"><img src="../images/next.png" alt="Next"></a>
</div>
</body>
</html>
